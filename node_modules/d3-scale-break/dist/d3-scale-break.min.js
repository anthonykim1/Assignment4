// https://github.com/lukewhyte/d3-scale-break#readme v0.1.11 Copyright 2020 Luke Whyte
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("d3-interpolate"),require("d3-scale"),require("d3-axis"),require("d3-array")):"function"==typeof define&&define.amd?define(["d3-interpolate","d3-scale","d3-axis","d3-array"],t):(e=e||self)["d3-scale-break"]=t(e["d3-interpolate"],e["d3-scale"],e["d3-axis"],e["d3-array"])}(this,(function(e,t,n,r){"use strict";function s(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function a(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if(!(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e)))return;var n=[],r=!0,s=!1,i=void 0;try{for(var a,o=e[Symbol.iterator]();!(r=(a=o.next()).done)&&(n.push(a.value),!t||n.length!==t);r=!0);}catch(e){s=!0,i=e}finally{try{r||null==o.return||o.return()}finally{if(s)throw i}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}var o=e=>({_isOutsideDomains:t=>{const n=e.domains.normalize,r=a(e.flip(e.domains.getExtent()),2),s=r[0],i=r[1];return n(t)<n(s)||n(t)>n(i)},_handleOutsideDomains:t=>{const n=e.domains.normalize,r=e.domains.getAll(),s=e.domains.getExtent(),i=a(s[1]<s[0]?[r.length-1,0]:[0,r.length-1],2),o=i[0],c=i[1];return n(e.flip(s)[0])>n(t)?o:c},mapValToIdx:t=>{const n=e.domains.normalize;return e._isOutsideDomains(t)?e._handleOutsideDomains(t):e.domains.getAll().findIndex(r=>{const s=a(e.flip(r),2),i=s[0],o=s[1];return n(t)>=n(i)&&n(t)<=n(o)})},mapVal:t=>{const n=e.mapValToIdx(t);return-1===n?e.unknown:e.scales.get(n)(t)}});class c{constructor(e){this._state=e,this._subscribers=[]}addSubscriber(e){this._subscribers.push(e)}removeSubscriber(e){this._subscribers=this._subscribers.filter(t=>t!==e)}notifySubscribers(){this._subscribers.forEach(e=>{const t=a(e.split("."),2),n=t[0],r=t[1];this._state[n]&&this._state[n][r]?this._state[n][r]():this.removeSubscriber(e)})}}const l=(e,t)=>(t-=e=+e)?n=>isNaN(n=+n)?void 0:(n-e)/t:isNaN(t)?NaN:.5,u=e=>{try{const t=e.length,n=e[0][0],r=e[t-1][e[t-1].length-1];return r<n?l(r,n):l(n,r)}catch(e){console.error(`Your domains could not be parsed. Check they are properly formatted. Err msg: ${e}`)}},g=(e,t)=>({listener:new c(e),normalize:u(t),set:n=>(((e,t)=>{const n=e.scopes.getAll();n.length&&n.length!==t.length&&(e.scopes.clear(),console.error("domains: scopes.length does not match domains.length"))})(e,n),t.splice(0,t.length,...n),e.domains.normalize=u(t),e.domains.listener.notifySubscribers(),t.slice())}),d=(e,t)=>({get:e=>t[e],getAll:()=>t.slice(),getExtent:()=>{const e=t;return[e[0][0],e[e.length-1][e[e.length-1].length-1]]}});var p=e=>{const t=[[0,1]];return{domains:Object.assign({},g(e,t),d(0,t))}};const m=(e,t)=>({listener:new c(e),set:n=>(t.splice(0,t.length,...n),e.range.listener.notifySubscribers(),t.slice())}),f=(t,n)=>({get:()=>n.slice(),getSlice:([n,r])=>{const s=a(t.range.get(),2),i=s[0],o=s[1];return r<n?[e.interpolate(o,i)(n),e.interpolate(o,i)(r)]:[e.interpolate(i,o)(n),e.interpolate(i,o)(r)]}});var h=e=>{const t=[0,100];return{range:Object.assign({},m(e,t),f(e,t))}};const b=(e,n)=>({add:(n,r)=>t[e.scaleType](n,e.range.getSlice(e.scopes.get(r))),update:(t,n)=>e.scales.get(n).domain(t).range(e.range.getSlice(e.scopes.get(n))),set:()=>{const t=e.domains.getAll().map((t,n)=>e.scales.get(n)?e.scales.update(t,n):e.scales.add(t,n));return n.splice(0,t.length,...t)}}),y=(e,t)=>({get:e=>t[e],getAll:()=>t});var k=e=>{const t=[];return{scales:Object.assign({},b(e,t),y(0,t))}};const O=(e,t)=>({listener:new c(e),set:n=>{if(n.length===e.domains.getAll().length)return t.splice(0,t.length,...n),e.scopes.listener.notifySubscribers(),t.slice();e.scopes.clear(),console.error("scopes: scopes.length does not match domains.length")},clear:()=>t.length=0}),S=(e,t)=>({get:n=>{if(t[n])return t[n];{const t=a(e.domains.get(n),2),r=t[0],s=t[1];return[e.domains.normalize(r),e.domains.normalize(s)]}},getAll:()=>t.slice()});var A=e=>{const t=[];return{scopes:Object.assign({},O(e,t),S(e,t))}};const _=[0,1],j=e=>({get unknown(){return e._unknown},set unknown(t){e._unknown=t},flip:([e,t])=>t<e?[t,e]:[e,t]});function v(e=[_],t=_){let n={scaleType:"scaleLinear"};return(n=>(n.domains.set(e),n.range.set(t),n.scales.set(),n.domains.listener.addSubscriber("scales.set"),n.range.listener.addSubscriber("scales.set"),n.scopes.listener.addSubscriber("scales.set"),n))(Object.assign(n,j(n),o(n),p(n),h(n),k(n),A(n)))}const w=(e,t)=>t<0?e.slice(0,t):e.concat(Array(t).fill(void 0)),x=(e,t)=>Array.isArray(e)?e.length===t?e:w(e,t-e.length):Array(t).fill(e),z=(e,t)=>Array.isArray(e)&&Array.isArray(e[0])?e.length===t?e:w(e,t-e.length):Array(t).fill(e),E=e=>{return Object.assign(e,{ticks:t=>(function(t){return e.mapScales((e,n)=>e.ticks(t[n]))})(x(t,e.domain().length)),tickFormat:(t,n)=>(function(t,n){return e.mapScales((e,r)=>e.tickFormat(t[r],n[r]))})(x(t,e.domain().length),x(n,e.domain().length)),nice:t=>(function(t){const n=e.mapScales((e,n)=>e.nice(t[n]));return e.domain(n.map(e=>e.domain()))})(x(t,e.domain().length))})},P=(t,n)=>{const r=(t=>{function n(e){return isNaN(e=+e)?t.unknown:t.mapVal(e)}return n.invert=e=>{return t.scales.getAll().find(n=>{const r=a(t.flip(n.range()),2),s=r[0],i=r[1];return e>=s&&e<=i}).invert(e)},n.domain=function(e){return arguments.length?(t.domains.set(e),n):t.domains.getAll()},n.range=function(e){return arguments.length?(t.range.set(e),n):t.range.get()},n.scope=function(e){return arguments.length?(t.scopes.set(e),n):t.scopes.getAll()},n.rangeRound=function(r){return t.range.set(r),n.interpolate(e.interpolateRound),n},n.clamp=function(e){return arguments.length?(t.scales.getAll().forEach(t=>t.clamp(e)),n):t.scales.get(0).clamp()},n.interpolate=function(e){return arguments.length?(t.scales.getAll().forEach(t=>t.interpolate(e)),n):t.scales.get(0).interpolate()},n.unknown=function(e){return arguments.length?(t.unknown=e,n):t.unknown},n.mapScales=e=>t.scales.getAll().map(e),n})(v(t,n));return r.copy=()=>(function(e,t){return t.domain(e.domain()).range(e.range()).interpolate(e.interpolate()).clamp(e.clamp()).unknown(e.unknown())})(r,P()),E(r)};const D=e=>{const t=(t,r)=>(e=>-1===e.findIndex(e=>void 0!==e))(r)?e.map(e=>e[t]()):(e.forEach((e,n)=>e[t](r[n])),n);function n(t){e.forEach((e,n)=>t.append("g").attr("class",`axis-${n}`).call(e))}return Object.assign(n,{scale:t=>(x(t,e.length),e.map(e=>e.scale())),ticks:(t,r)=>(function(t,r){return e.forEach((e,n)=>e.ticks(t[n],r[n])),n})(x(t,e.length),x(r,e.length)),tickArguments:n=>t("tickArguments",z(n,e.length)),tickValues:n=>t("tickValues",z(n,e.length)),tickFormat:n=>t("tickFormat",x(n,e.length)),tickSize:n=>t("tickSize",x(n,e.length)),tickSizeInner:n=>t("tickSizeInner",x(n,e.length)),tickSizeOuter:n=>t("tickSizeOuter",x(n,e.length)),tickPadding:n=>t("tickPadding",x(n,e.length))})};var N=(e,t)=>{const n=a(r.extent(e),2),s=n[0],i=n[1];return((e,t,n)=>n.reduce((e,r,s)=>(e.push([r,n.length===s+1?t:n[s+1]]),e),[[e,n[0]]]))(s,i,t.sort().filter(((e,t)=>n=>e(n)&&t(n))((e=>t=>t>e)(s),(e=>t=>t<e)(i))))};const I=(e,t)=>e-t;var T=(e,t)=>{const n=((e,t)=>{const n=[0];let r=0,s=0;for(;r<t.length;)e[s]<=t[r]?(n[r]+=1,s+=1):(r+=1,n[r]=0);return n[r]=e.slice(s).length,n})(e.sort(I),t.sort(I)),r=e.length;return n.reduce((e,t,n)=>{const s=e[n-1]?e[n-1][1]:0,i=(100*s+100*+(t/r).toFixed(2))/100;return e.push([s,i>1?1:i>.95?1:i]),e},[]).filter(e=>!(0===e[0]&&0===e[1]||1===e[0]&&1===e[1]))};return function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){s(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},Object.freeze({__proto__:null,scaleLinear:P}),{},Object.freeze({__proto__:null,axisTop:function(e){return D(e.mapScales(e=>n.axisTop(e)))},axisRight:function(e){return D(e.mapScales(e=>n.axisRight(e)))},axisBottom:function(e){return D(e.mapScales(e=>n.axisBottom(e)))},axisLeft:function(e){return D(e.mapScales(e=>n.axisLeft(e)))}}),{},Object.freeze({__proto__:null,breakDomain:N,breakScope:T,breakData:(e,t)=>({domain:N(e,t),scope:T(e,t)})}))}));
